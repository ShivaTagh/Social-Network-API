'use strict';

const pkg = require('./package.json');
const gulp = require('gulp');
const exec = require('child_process').exec;
const pages = require('gulp-gh-pages');

gulp.task('docs', done => {
    exec('node ./node_modules/jsdoc/jsdoc -c ./config/docs.json -P ./package.json -d ./docs/', undefined, done);
});

gulp.task('dev:docs', () => {
    gulp.watch('./config/src/**/*.css', ['docs']);
})

gulp.task('publish', ['docs'], done => {
    var timestamp = new Date().toISOString();
    return gulp.src(`./docs/${pkg.name}/${pkg.version}/**/*`)
        .pipe(pages({
            remoteUrl: 'https://github.com/janbiasi/appdata',
            origin: 'origin',
            branch: 'gh-pages',
            cacheDir: '.publish',
            message: `Deploy ${pkg.name} docs for v${pkg.version} at ${timestamp}`
        }));
});
